---
title: "code"
output: html_document
date: "2024-04-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(MatchIt)
library(randomForest)
library(caret)
library(tidyverse)
library(VIM)


```



## Option 2: Explore a provided dataset for pre-specified research goals

I decided to go with *option c*, which involves constructing a propensity score to aid in an epidemiologic analysis of an etiologic question and then
performing an analysis using the propensity score to address that etiologic question.

My research question is as follows: How does length of hospital stay and subsequent patient disposition vary by type of insurance coverage in surgical patients?

After considering the nature of my research question, I considered the following variables to be key to answering my research question,

*Primary Variables:*
Length of Stay (length_of_stay): The primary outcome variable.
Patient Disposition (patient_disposition): The secondary outcome variable indicating what happens to patients after surgery (e.g., discharged to home, transferred to another facility).
Type of Insurance Coverage (payment_typology_1, payment_typology_2, payment_typology_3): The primary explanatory variables. These indicate the insurance coverage types of the patients.

*Control Variables:*
Age Group (age_group): Older patients might stay longer in hospitals due to complications.
APR Severity of Illness (apr_severity_of_illness_description): This might influence both the length of stay and patient disposition.
APR Risk of Mortality (apr_risk_of_mortality): This is crucial as it likely correlates with both the severity of the illness and the outcomes.
Type of Admission (type_of_admission): Emergency, urgent, elective, etc., could affect both the length of stay and the type of disposition.
APR Medical Surgical Description (apr_medical_surgical_description): Whether the admission was for a surgical procedure or a medical condition could impact the length of stay and disposition.




### Loading and pre-cleaning data
```{r}
hospital_df = read_csv("./data/sparcs_hospital.csv") %>% janitor::clean_names()

## checking more missingness
  # Sum of NA values in each column
sum_na <- sapply(hospital_df, function(x) sum(is.na(x)))

# Proportion of NA values in each column
prop_na <- sapply(hospital_df, function(x) mean(is.na(x))) * 100

# Print results
print(sum_na)
print(prop_na)
```


I noticed the secondary and tertiary insurance types were missing for alot of patients, likley indicating that there is no additional coverage for these patients. They were classified into a no additional coverage category below. 
```{r}
# For payment_typology_2 and payment_typology_3
hospital_df$payment_typology_2[is.na(hospital_df$payment_typology_2)] <- "No Additional Coverage"
hospital_df$payment_typology_3[is.na(hospital_df$payment_typology_3)] <- "No Additional Coverage"

# For apr_severity_of_illness_description using mice for multiple imputation
library(mice)
imp_data <- mice(data[, c("apr_severity_of_illness_description", "apr_risk_of_mortality", "other_variables_if_needed")], m=5, method='pmm', seed=500)
completed_data <- complete(imp_data, 1)

```

